{% extends 'base.html' %}
{% from 'bootstrap/pagination.html' import render_pagination %}
{% from 'macros.html' import photo_card with context %}
{% from 'macros.html' import searchbar with context %}

{% block title %}Home{% endblock %}

{% block content %}
{% if current_user.is_authenticated %}
    <div class="row justify-content-md-center ">
        <div class="container">
            <div class="row m-2">
                <div class="col-md-9">
                    {{ searchbar(class='index') }}
{#                    {% include 'main/_searchbar.html' %}#}
                </div>
                <div class="col-md-3">
                    <ul class="nav nav-pills nav-justified">
                        <li class="nav-item">
                            <a class="nav-link active" href="{{ url_for('main.new_survey') }}" target="_blank">新建问卷</a>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="row m-2">
                <div class="col-md-9 ">
                    {% if surveys %}
                        {% for survey in surveys %}
                            <div class="container m-4" data-id="{{ survey.id }}" data-name="{{ survey.name }}">
                                <div class="card">
                                <div class="row">
                                    <div class="col-md-9">
                                            <div class="container">
                                                <div class="row">
                                                    <a class="black2blue font-weight-bold nav-item nav-link" href="{{ url_for('main.display', survey_id=survey.id) }}" target="_blank">
                                                        <h5>{{ survey.title }}</h5>
                                                    </a>
                                                </div>
                                            </div>
                                            <div class="container">
                                                <div class="row">
                                                    <div class="col-md-2 ">
                                                        <a class="grey2blue" href="{{ url_for('main.edit_survey', survey_id=survey.id) }}" target="_blank">
                                                            <span class="oi oi-file"></span>设计
                                                        </a>
                                                    </div>
                                                    <div class="col-md-2 ">
                                                        <a class="grey2blue" href="{{ url_for('main.send_survey', survey_id=survey.id) }}" target="_blank">
                                                            <span class="oi oi-external-link"></span>发送
                                                        </a>
                                                    </div>
                                                    <div class="col-md-2 ">
                                                        {% if survey.is_published %}
                                                            <a class="grey2blue" href="{{ url_for('main.change_survey_status', survey_id=survey.id, action='unpublish') }}">
                                                                <span class="oi oi-play-circle"></span>
                                                                停止
                                                            </a>
                                                        {% else %}
                                                            <a class="grey2blue" href="{{ url_for('main.change_survey_status', survey_id=survey.id, action='publish') }}">
                                                                <span class="oi oi-play-circle"></span>
                                                                发布
                                                            </a>
                                                        {% endif %}
                                                    </div>
                                                    <div class="col-md-2 ">
                                                        <a class="grey2blue" href="{{ url_for('main.set_survey', survey_id=survey.id) }}"  target="_blank">
                                                            <span class="oi oi-cog"></span>设置
                                                        </a>
                                                    </div>
                                                    <div class="col-md-2 ">
                                                        <a class="grey2blue" href="{{ url_for('main.analyse_survey', survey_id=survey.id) }}" target="_blank">
                                                            <span class="oi oi-bar-chart"></span>分析
                                                        </a>
                                                    </div>
                                                    <div class="col-md-2 ">
                                                        <a class="grey2blue" href="{{ url_for('main.delete_survey', survey_id=survey.id) }}">
                                                            <span class="oi oi-trash"></span>删除
                                                        </a>
                                                    </div>
                                                </div>
                                            </div>

                                    </div>
                                    <div class="col-md-3" >
                                            <div class="text-left">
                                                <a style="font-size: 10px">状态：<a style="color: #007bff;font-size: 10px">{% if survey.is_published %}已{% else %}未{% endif %}发布</a></a>
                                            </div>
                                            <div class="text-left" >
                                                <a style="font-size: 10px">答卷：<a style="color: #007bff;font-size: 10px">{{ survey.participants|length }}</a></a>
                                            </div>
                                            <div class="text-left">
{#                                                <a style="font-size: 10px">时间：{{ survey.timestamp.strftime("%Y-%m-%d %H:%M") }}</a>#}
                                                <a style="font-size: 10px">时间：{{ moment(survey.timestamp).format("Y-M-D HH:MM") }}</a>
                                            </div>
                                    </div>
                                </div>
                                </div>
                            </div>

{#                    <div class="card mb-3 w-100 bg-light">#}
{#                        <div class="card-header">#}
{#                            <a class="dead-link" href="{{ url_for('user.index', username=photo.author.username) }}">#}
{#                                <img class="rounded img-fluid avatar-s profile-popover"#}
{#                                     data-href="{{ url_for('ajax.get_profile', user_id=photo.author.id) }}"#}
{#                                     src="{{ url_for('main.get_avatar', filename=photo.author.avatar_m) }}">#}
{#                            </a>#}
{#                            <a class="profile-popover trend-card-avatar"#}
{#                               data-href="{{ url_for('ajax.get_profile', user_id=photo.author.id) }}"#}
{#                               href="{{ url_for('user.index', username=photo.author.username) }}">{{ photo.author.name }}</a>#}
{#                            <span class="float-right">#}
{#                <small data-toggle="tooltip" data-placement="top" data-timestamp="{{ photo.timestamp }}"#}
{#                       data-delay="500">#}
{#                    {{ moment(photo.timestamp).fromNow(refresh=True) }}</small></span>#}
{#                        </div>#}
{#                        <div class="card-body">#}
{#                            <div class="" align="center">#}
{#                                <a class="thumbnail" href="{{ url_for('.show_photo', photo_id=photo.id) }}"#}
{#                                   target="_blank">#}
{#                                    <img class="img-fluid"#}
{#                                         src="{{ url_for('.get_image', filename=photo.filename_m) }}">#}
{#                                </a>#}
{#                            </div>#}
{#                        </div>#}
{#                        <div class="card-footer">#}
{#                            <span class="oi oi-star"></span>#}
{#                            <span id="collectors-count-{{ photo.id }}"#}
{#                                  data-href="{{ url_for('ajax.collectors_count', photo_id=photo.id) }}">#}
{#                                {{ photo.collectors|length }}#}
{#                            </span>#}
{#                            <span class="oi oi-comment-square"></span> {{ photo.comments|length }}#}
{#                            <div class="float-right">#}
{#                                {% if current_user.is_authenticated %}#}
{#                                    <button class="{% if not current_user.is_collecting(photo) %}hide{% endif %}#}
{#                                     btn btn-outline-secondary btn-sm uncollect-btn"#}
{#                                            data-href="{{ url_for('ajax.uncollect', photo_id=photo.id) }}"#}
{#                                            data-id="{{ photo.id }}">#}
{#                                        <span class="oi oi-x"></span> Uncollect#}
{#                                    </button>#}
{#                                    <button class="{% if current_user.is_collecting(photo) %}hide{% endif %}#}
{#                                     btn btn-outline-primary btn-sm collect-btn"#}
{#                                            data-href="{{ url_for('ajax.collect', photo_id=photo.id) }}"#}
{#                                            data-id="{{ photo.id }}">#}
{#                                        <span class="oi oi-star"></span> Collect#}
{#                                    </button>#}
{#                                {% else %}#}
{#                                    <form class="inline" method="post"#}
{#                                          action="{{ url_for('main.collect', photo_id=photo.id) }}">#}
{#                                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">#}
{#                                        <button type="submit" class="btn btn-outline-primary btn-sm">#}
{#                                            <span class="oi oi-star"></span> Collect#}
{#                                        </button>#}
{#                                    </form>#}
{#                                {% endif %}#}
{#                            </div>#}
{#                            {% if photo.description %}#}
{#                                <p class="card-text">{{ photo.description }}</p>#}
{#                            {% endif %}#}
{#                        </div>#}
{#                    </div>#}

				{% endfor %}
            {% else %}
                <div class="tip text-center">
                    <h3>暂无问卷.</h3>
                    <p><a href="{{ url_for('.explore') }}">探索</a></p>
                </div>
            {% endif %}
        </div>
                <div class="col-md-3">
                    {% include 'main/_sidebar.html' %}
                </div>
            </div>
        </div>
    </div>
    {% if surveys %}
        {{ render_pagination(pagination, align='center') }}
    {% endif %}
{% else %}
    <div class="jumbotron">
        <div class="row">
            <div class="col-md-8">
                <img src="{{ url_for('static', filename='images/index.jpg') }}" class="rounded img-fluid">
            </div>
            <div class="col-md-4 align-self-center">
                <h1>Vanswer</h1>
                <p>调查，随时随地.</p>
                <p><a class="btn btn-primary btn-lg" href="{{ url_for('auth.register') }}">即刻注册</a></p>
            </div>
        </div>
    </div>
{% endif %}
{% endblock %}
